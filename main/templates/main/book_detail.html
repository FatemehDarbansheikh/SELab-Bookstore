{% extends 'main/base.html' %}

{% block title %}
{{ book.title }} | کتاب‌فروشی 
{% endblock %}

{% block content %}

<div class="book-detail-grid">

    <div class="book-cover">
        {% if book.cover %}
            <img src="{{ book.cover.url }}" alt="{{ book.title }}">
        {% else %}
            <img src="https://via.placeholder.com/400x550?text=Book">
        {% endif %}
    </div>

    <div class="book-info">
        <h2 class="book-detail-title">{{ book.title }}</h2>

        <p class="book-meta">شابک:{{ book.ISBN }}</p>

        <p class="book-meta">
            نویسنده:
            {% for author in book.authors.all %}
                {{ author.first_name }} {{ author.last_name }}{% if not forloop.last %}،{% endif %}
            {% endfor %}
        </p>

        <p class="book-meta">ناشر: {{ book.publisher.name }}</p>

        <p class="book-meta">
            دسته‌بندی:
            {% for cat in book.categories.all %}
                {{ cat.name }}{% if not forloop.last %}،{% endif %}
            {% endfor %}
        </p>

        <p class="book-meta">تاریخ انتشار: {{book.publication_date|date:"Y/m/d"}}</p>
        {% if avg_rating %}
            <p class="book-rating">
                ⭐ امتیاز میانگین: {{ avg_rating|floatformat:1 }} از 5
            </p>
        {% endif %}

        <div class="book-price-large">قیمت: {{ book.price }} تومان</div>

        <div class="book-actions">
            <a href="{% url 'add_to_cart' book.id %}" class="btn btn-primary">
                افزودن به سبد خرید
            </a>

            <a href="{% url 'add_to_wishlist' book.id %}" class="btn btn-outline">
                افزودن به علاقه‌مندی‌ها
            </a>
        </div>
    </div>
</div>

{% if book.description %}
<section class="book-description">
    <h3>توضیحات کتاب</h3>
    <p >{{ book.description }}</p>
</section>
{% endif %}

<section class="book-reviews">
    <h3>نظرات کاربران</h3>

    {% if reviews %}
        {% for review in reviews %}
            <div class="review-card">
                <strong>{{ review.user.username }}</strong>
                <span class="review-rating">⭐ {{ review.rating }}</span>
                <p>{{ review.comment }}</p>
            </div>
        {% endfor %}
    {% else %}
        <p class="review-card">هنوز نظری ثبت نشده است.</p>
    {% endif %}

    {% if user.is_authenticated %}
        <a href="{% url 'add_review' book.id %}" class="btn btn-primary review-btn">
            ثبت نظر
        </a>
    {% else %}
        <p class="login-hint">
            برای ثبت نظر ابتدا
            <a href="{% url 'login' %}">وارد شوید</a>.
        </p>
    {% endif %}
</section>

{% endblock %}
