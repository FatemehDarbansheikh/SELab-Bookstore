{% extends 'main/base.html' %}
{% load math_filters %}

{% block title %}
جزئیات سفارش | کتاب‌‌فروشی 
{% endblock %}

{% block content %}

<h2 class="page-title">جزئیات سفارش</h2>

<div class="order-summary-box">
    <p><strong>شماره سفارش:</strong> {{ order.id }}</p>
    <p><strong>تاریخ ثبت:</strong> {{ order.order_date|date:"Y/m/d H:i" }}</p>
    <p><strong>وضعیت:</strong> {{ order.get_status_display }}</p>
    <p><strong>مبلغ کل:</strong> {{ order.total_amount }} تومان</p>
</div>

<div class="table-wrapper">
    <table class="table">
        <thead>
            <tr>
                <th>کتاب</th>
                <th>قیمت واحد</th>
                <th>تعداد</th>
                <th>جمع</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td>{{ item.book.title }}</td>
                <td>{{ item.unit_price }} تومان</td>
                <td>{{ item.quantity }}</td>
                <td>{{ item.unit_price|multiply:item.quantity }} تومان</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="order-address-box">
    <h3>آدرس ارسال</h3>
    <p>
        {{ order.address.country }}،
        {{ order.address.city }}،
        {{ order.address.street }}،
        کد پستی: {{ order.address.postal_code }}
    </p>
</div>

{% if order.status != 'cancelled' and order.status != 'shipped' and order.status != 'delivered' %}
<form method="post"
      action="{% url 'cancel_order' order.id %}"
      class="order-actions">
    {% csrf_token %}
    <button class="btn btn-danger"
            onclick="return confirm('آیا از لغو سفارش مطمئن هستید؟')">
        لغو سفارش
    </button>
</form>
{% endif %}

<a href="{% url 'order_history' %}" class="btn btn-outline back-link">
    بازگشت به سفارش‌ها
</a>

{% endblock %}
