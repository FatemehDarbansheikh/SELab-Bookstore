{% extends 'main/base.html' %}

{% block title %}
لیست کتاب‌ها | کتاب‌فروشی 
{% endblock %}

{% block content %}

<h2 class="page-title">کتاب‌ها</h2>

<form method="get" class="book-filter-form">

    <input type="text"
           name="q"
           placeholder="جستجوی کتاب و نویسنده..."
           value="{{ request.GET.q }}"
           class="search-input">

    <select name="category">
        <option value="">همه دسته‌بندی‌ها</option>
        {% for cat in categories %}
            <option value="{{ cat.id }}"
                {% if request.GET.category == cat.id|stringformat:"s" %}
                    selected
                {% endif %}
            >
                {{ cat.name }}
            </option>
        {% endfor %}
    </select>

    <select name="sort">
        <option value="">مرتب‌ سازی</option>
        <option value="price_low"
            {% if request.GET.sort == 'price_low' %}selected{% endif %}
        >
            ارزان‌ ترین
        </option>
        <option value="price_high"
            {% if request.GET.sort == 'price_high' %}selected{% endif %}
        >
            گران‌ ترین
        </option>
    </select>

    <button class="btn btn-primary">اعمال</button>
</form>

{% if books %}
        <div class="book-grid">
            {% for book in books %}
                <div class="book-card">
                    {% if book.cover %}
                        <img src="{{ book.cover.url }}" alt="{{ book.title }}">
                    {% else %}
                        <img src="https://via.placeholder.com/300x400?text=Book" alt="Book">
                    {% endif %}

                    <div class="book-title">{{ book.title }}</div>
                    <div class="book-mata">{% for author in book.authors.all %}
                        {{ author.first_name }} {{ author.last_name }}{% if not forloop.last %}،{% endif %}
                        {% endfor %}</div>
                    <div class="book-price">{{ book.price }} تومان</div>

                    <a href="{% url 'book_detail' book.id %}" class="btn btn-primary">
                     مشاهده جزئیات
                    </a>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>کتابی برای نمایش وجود ندارد.</p>
    {% endif %}

{% endblock %}
